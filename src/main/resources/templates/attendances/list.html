<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Посещаемость - Журнал</title>
    <link th:replace="~{fragments :: styles}">
</head>
<body>
<div th:replace="~{fragments :: header}"></div>
<div th:replace="~{fragments :: nav}"></div>

<div class="container">
    <div class="content">
        <div class="page-header">
            <h1>Посещаемость студентов</h1>
            <form method="get" action="/attendances/mark" class="inline-form">
                <div class="form-group">
                    <label>Группа</label>
                    <input type="text"
                           name="groupName"
                           placeholder="Введите группу"
                           th:value="${groupName}">
                </div>


                <select name="subjectId" required>
                    <option value="">Выберите предмет</option>
                    <option th:each="subject : ${subjects}"
                            th:value="${subject.id}"
                            th:text="${subject.name}"></option>
                </select>
                <button type="submit" class="btn btn-success">Отметить посещаемость</button>
            </form>
        </div>

        <div th:if="${message}" class="alert" th:text="${message}"></div>

        <div class="filter-form">
            <form method="get" action="/attendances">
                <div class="form-group">
                    <label>Студент</label>
                    <input type="text"
                           name="studentName"
                           placeholder="Фамилия студента"
                           th:value="${studentName}">
                </div>
                <div class="form-group">
                    <label>Группа</label>
                    <input type="text"
                           name="groupName"
                           placeholder="Название группы"
                           th:value="${groupName}">
                </div>
                <div class="form-group">
                    <label for="subjectId">Предмет</label>
                    <select id="subjectId" name="subjectId">
                        <option value="">Все предметы</option>
                        <option th:each="subject : ${subjects}"
                                th:value="${subject.id}"
                                th:text="${subject.name}"
                                th:selected="${subjectId != null and subjectId == subject.id}"></option>
                    </select>
                </div>
                <button type="submit" class="btn">Фильтровать</button>
                <a href="/attendances" class="btn">Сбросить</a>
            </form>
        </div>

        <div th:if="${attendances != null and !attendances.isEmpty()}" class="table-wrapper">
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Студент</th>
                    <th>Предмет</th>
                    <th>Дата</th>
                    <th>Посещение</th>
                    <th>Примечание</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="attendance : ${attendances}">
                    <td th:text="${attendance.id}"></td>
                    <td th:text="${attendance.student.fullName}"></td>
                    <td th:text="${attendance.subject.name}"></td>
                    <td th:text="${#temporals.format(attendance.date, 'dd.MM.yyyy')}"></td>
                    <td>
                        <span th:if="${attendance.present}" class="present-indicator present">✓ Присутствовал</span>
                        <span th:if="${!attendance.present}" class="present-indicator absent">✗ Отсутствовал</span>
                    </td>
                    <td th:text="${attendance.note != null ? attendance.note : '-'}"></td>
                    <td>
                        <a th:href="@{/attendances/{id}/delete(id=${attendance.id})}" class="btn btn-danger btn-small" onclick="return confirm('Вы уверены?')">Удалить</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div th:if="${attendances == null or attendances.isEmpty()}" class="empty-state">
            <p>Записи посещаемости не найдены. Отметьте посещаемость для студентов.</p>
        </div>
    </div>
</div>
</body>
</html>
